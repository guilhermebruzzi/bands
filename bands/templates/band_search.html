{% import 'bootstrap_modal.html' as modal_generico %}
{% import 'band_question.html' as band_question %}
{% import 'band_tags.html' as band_tags %}
{% import 'bandas_relacionadas.html' as bandas_relacionadas %}
{% import 'band_products.html' as band_products %}
{% import 'contribuicao_timeline.html' as contribuicao %}

{% macro escreve_banda(band, show, notas, BANDAS_CAMISAS, formulario_pag_seguro) -%}
    <li id="{{ band.slug }}" class="banda-container-li round-component box-gray">
        <h2 id="band-header" class="info-banda-header">
            {% if band.photo %}
                <span title="imagem da banda" class="photo-icon small" style="background-image: url('{{ band.photo }}');"></span>
            {% else %}
                <span title="imagem da banda" class="photo-icon icone-banda-default small"></span>
            {% endif %}
            <span class="info-banda-nome">{{ band.name }}</span>
            <div class="share invisivel">
                <!-- AddThis Button BEGIN -->
                <div class="addthis_toolbox addthis_default_style" addthis:url="http://bands.com.br/?band={{ band.slug }}" addthis:title="Bands - {{ band.name }}" addthis:description="Confira {{ band.name }} em http://bands.com.br/?band={{ band.slug }}">
                    <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
                    <div class="shares-menores">
                        <a class="addthis_button_facebook" addthis:ui_use_css="false"></a>
                        <a class="addthis_button_twitter" addthis:ui_use_css="false"></a>
                        <a class="addthis_button_compact"></a>
                        <a class="addthis_counter addthis_bubble_style"></a>
                    </div>
                </div>
                <!-- AddThis Button END -->
            </div>

            <label class="label">&#43; Clique para expandir</label>
        </h2>

        <div id="area-banda" class="area-banda hidden">
            {% if band.photo %}
                <img class="lastfm-photo logo-banda" alt="imagem da banda" src="{{ band.photo }}" />
            {% else %}
                <span title="imagem da banda" class="lastfm-photo logo-banda icone-banda-default"></span>
            {% endif %}
            <div class="logo-banda-container" title="imagem da banda"></div>
        </div>

        <div id="info-banda" class="info-banda hidden">
            <div class="info-banda-genero-div">
                <a class="info-banda-genero info-banda-link" data-toggle="modal" data-target="#modal-tags-{{ band.slug }}" href="#{{ band.slug }}">{{ band.tags[0] }}</a>
                <span class="info-banda-header-menor">Nota:
                    <select class="nota">
                        {% for nota in notas %}
                            <option value="{{ nota }}" {% if nota == 7 %}selected="selected"{% endif %}>{{ nota }}</option>
                        {% endfor %}
                    </select>
                </span>
                <span class="info-banda-header-menor">Favoritar: <a href="#{{ band.slug }}" class="favoritar"></a></span>
            </div>
            <div class="banda-mais-opcoes">
                <button type="button" class="shiny-red" data-toggle="modal" data-target="#modal-relacionadas-{{ band.slug }}" onClick="_gaq.push(['_trackEvent', 'Band', 'Bandas relacionadas em uma pesquisa de banda', 'Banda: {{  band.name | escape  }}']);">Bandas relacionadas</button>
                <button type="button" class="shiny-red" data-toggle="modal" data-target="#modal-pergunte-{{ band.slug }}" onClick="_gaq.push(['_trackEvent', 'Band', 'Pergunte sobre a banda em uma pesquisa de banda', 'Banda: {{  band.name | escape  }}']);">Faça uma pergunta sobre a banda</button>
            </div>
            {% if show %}
                <h3>Shows</h3>
                {%- set website = show.website -%}
                {% if not website %}
                    {%- set website = show.location.website -%}
                {% endif %}
                <div class="navegacao-show-container">
                    <button type="button" title="show anterior" class="band-navegacao-show band-prev-show" data-toggle="modal" data-target="#modal-mais-shows" onClick="_gaq.push(['_trackEvent', 'Show', 'Mais shows Esq em uma pesquisa de banda', 'Banda: {{  band.name | escape  }}']);"></button>
                    <a {% if website %} href="{{ website }}" target="_blank" {% else %} href="#" {% endif %} class="item-lista-shows item-lista-bands" onClick="_gaq.push(['_trackEvent', 'Show', 'Show em uma pesquisa de banda', 'Banda: {{  band.name | escape  }} Show: {{ show.title }}']);">
                        {% if show.cover_image %}
                            <img alt="imagem do show" title="imagem do show" src="{{ show.cover_image }}" />
                        {% else %}
                            {% if show.location.image %}
                                <img alt="imagem do show" title="imagem do show" src="{{ show.location.image }}" />
                            {% else %}
                                <span title="imagem do show" class="icone-musicas img-default"></span>
                            {% endif %}
                        {% endif %}
                        <span class="info-show item-info">
                            <span class="banda-show">{{ show.datetime }}</span>
                            <span class="data-show">{{ show.title }}</span>
                        </span>
                    </a>
                    <button type="button" title="próximo show" class="band-navegacao-show band-next-show" data-toggle="modal" data-target="#modal-mais-shows" onClick="_gaq.push(['_trackEvent', 'Show', 'Mais shows Dir em uma pesquisa de banda', 'Banda: {{  band.name | escape  }}']);"></button>
                </div>
            {% else %}
                <div class="navegacao-show-container"></div>
            {% endif %}
            <div class="banda-mais-opcoes banda-mais-opcoes-baixo">
                {% if band.slug == "los-bife" %}
                    <a type="button" class="shiny-red" href="/los-bife" target="_blank" onClick="_gaq.push(['_trackEvent', 'Produtos', 'Comprar produtos em uma pesquisa de banda', 'Banda: {{ band.name | escape }}']);">Comprar produtos (cds, camisas, etc.)</a>
                {% else %}
                    <button type="button" class="shiny-red" data-toggle="modal" data-target="#modal-produtos-{{ band.slug }}" onClick="_gaq.push(['_trackEvent', 'Produtos', 'Comprar produtos em uma pesquisa de banda', 'Banda: {{ band.name | escape }}']);">Comprar produtos (cds, camisas, etc.)</button>
                {% endif %}
            </div>
        </div>

        <div id="{{ band.slug }}-timeline" class="timeline-banda invisivel">
            <h3>Timeline</h3>
            <button type="button" class="shiny-red" data-toggle="modal" data-target="#modal-contribuicao-{{ band.slug }}" onClick="_gaq.push(['_trackEvent', 'Band Timeline', 'Botao colabore', 'Banda: {{  band.name | escape  }}']);">Clique aqui para contribuir</button>
            <iframe src="/band/{{ band.slug }}-timeline.html" style="border: 0">
                <p>Seu navegador não suporta iframes e assim não podemos exibir a timeline para você.</p>
            </iframe>
        </div>

        <div class="comentarios invisivel">
            <a class="mostrar-comentarios info-banda-link" href="#disqus_thread" onclick="loadDisqus(jQuery(this), 'http://bands.com.br/?band={{ band.slug }}', 'http://bands.com.br/?band={{ band.slug }}');">
                Mostrar comentários
            </a>

            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'bands';
                var disqus_identifier = 'http://bands.com.br/?band={{ band.slug }}';
                var disqus_url = 'http://bands.com.br/?band={{ band.slug }}'; //post permalink
                // var disqus_title; //post title

                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function () {
                    var s = document.createElement('script'); s.async = true;
                    s.type = 'text/javascript';
                    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
                    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
                }());
            </script>

        </div>


        {{ band_question.gera_modal(band.slug) }}
        {{ band_tags.gera_modal(band) }}
        {{ bandas_relacionadas.gera_modal(band) }}
        {{ band_products.gera_modal(band, BANDAS_CAMISAS, formulario_pag_seguro) }}
        {{ contribuicao.gera_modal(band) }}

        <button type="button" class="close-banda" onClick="_gaq.push(['_trackEvent', 'Band', 'Fechar o box da banda', 'Banda: {{  band.name | escape  }}']);">&times;</button>
    </li>
{%- endmacro %}
