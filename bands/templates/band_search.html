{% import 'bootstrap_modal.html' as modal_generico %}
{% import 'band_question.html' as band_question %}
{% import 'band_tags.html' as band_tags %}
{% import 'bandas_relacionadas.html' as bandas_relacionadas %}
{% import 'band_products.html' as band_products %}
{% import 'contribuicao_timeline.html' as contribuicao %}

{% macro escreve_banda(band, show, notas, BANDAS_CAMISAS, formulario_pag_seguro) -%}
    <li id="{{ band.slug }}" class="banda-container-li round-component box-gray">
        <h2 id="band-header" class="info-banda-header">
            {% if band.photo %}
                <span title="imagem da banda" class="photo-icon small" style="background-image: url('{{ band.photo }}');"></span>
            {% else %}
                <span title="imagem da banda" class="photo-icon icone-banda-default small"></span>
            {% endif %}
            <span class="info-banda-nome">{{ band.name }}</span>
            <a class="info-banda-genero info-banda-link" data-toggle="modal" data-target="#modal-tags-{{ band.slug }}" href="#{{ band.slug }}">{{ band.tags[0] }}</a>
            <div class="share">
                <!-- AddThis Button BEGIN -->
                <div class="addthis_toolbox addthis_default_style" addthis:url="http://bands.com.br/?band={{ band.slug }}" addthis:title="Bands - {{ band.name }}" addthis:description="Confira {{ band.name }} em http://bands.com.br/?band={{ band.slug }}">
                    <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
                     <a class="addthis_button_tweet"></a>
                </div>
                <div class="favoritar-body"><span class="favoritar-texto">Favoritar</span> <a href="#{{ band.slug }}" class="favoritar"></a></div>
                <!-- AddThis Button END -->
            </div>
            <label class="label info-banda-link">&#43; Clique para expandir</label>
        </h2>

        <div id="{{ band.slug }}-timeline" class="timeline-banda invisivel">
            <h3 class="titulo-no-box titulo-timeline-no-box">Timeline</h3>
            <div class="contribua-timeline-body contribua-timeline-cima">
                <button type="button" class="shiny-red contribua-timeline" data-toggle="modal" data-target="#modal-contribuicao-{{ band.slug }}">Contribua com a timeline</button>
            </div>
            <iframe src="/band/{{ band.slug }}-timeline.html" style="border: 0">
                <p>Seu navegador não suporta iframes e assim não podemos exibir a timeline para você.</p>
            </iframe>
            <div class="contribua-timeline-body">
                <button type="button" class="shiny-red contribua-timeline" data-toggle="modal" data-target="#modal-contribuicao-{{ band.slug }}">Contribua com a timeline</button>
            </div>
        </div>

        <div id="info-banda" class="info-banda hidden">

            <div class="banda-mais-opcoes">
                {% if band.slug == "los-bife" %}
                    <a type="button" class="shiny-red" href="/los-bife" target="_blank" onClick="_gaq.push(['_trackEvent', 'Produtos', 'Comprar produtos em uma pesquisa de banda', 'Banda: {{ band.name | escape }}']);">Comprar produtos (cds, camisas, etc.)</a>
                {% else %}
                    <button type="button" class="shiny-red" data-toggle="modal" data-target="#modal-produtos-{{ band.slug }}" onClick="_gaq.push(['_trackEvent', 'Produtos', 'Comprar produtos em uma pesquisa de banda', 'Banda: {{ band.name | escape }}']);">Compre produtos</button>
                {% endif %}
                <button type="button" class="shiny-red pergunte-sobre-a-banda" data-toggle="modal" data-target="#modal-pergunte-{{ band.slug }}" onClick="_gaq.push(['_trackEvent', 'Band', 'Pergunte sobre a banda em uma pesquisa de banda', 'Banda: {{  band.name | escape  }}']);">Pergunte sobre a banda</button>
            </div>
            {% if show %}
                <h3 class="titulo-no-box titulo-proximos-shows-no-box">Próximos Shows</h3>
                {%- set website = show.website -%}
                {% if not website %}
                    {%- set website = show.location.website -%}
                {% endif %}
                <div class="navegacao-show-container">
                    <button type="button" title="show anterior" class="band-navegacao-show band-prev-show" data-toggle="modal" data-target="#modal-mais-shows" onClick="_gaq.push(['_trackEvent', 'Show', 'Mais shows Esq em uma pesquisa de banda', 'Banda: {{  band.name | escape  }}']);"></button>
                    <div class="item-lista-bands">
                        <a {% if website %} href="{{ website }}" target="_blank" {% else %} href="#" {% endif %} class="item-lista-shows" onClick="_gaq.push(['_trackEvent', 'Show', 'Show em uma pesquisa de banda', 'Banda: {{  band.name | escape  }} Show: {{ show.title }}']);">
                            {% if show.cover_image %}
                                <img alt="imagem do show" title="imagem do show" src="{{ show.cover_image }}" />
                            {% else %}
                                {% if show.location.image %}
                                    <img alt="imagem do show" title="imagem do show" src="{{ show.location.image }}" />
                                {% else %}
                                    <span title="imagem do show" class="icone-musicas img-default"></span>
                                {% endif %}
                            {% endif %}
                            <span class="info-show item-info">
                                <span class="banda-show">{{ show.datetime }}</span>
                                <span class="data-show">{{ show.title }}</span>
                            </span>
                        </a>
                    </div>
                    <button type="button" title="próximo show" class="band-navegacao-show band-next-show" data-toggle="modal" data-target="#modal-mais-shows" onClick="_gaq.push(['_trackEvent', 'Show', 'Mais shows Dir em uma pesquisa de banda', 'Banda: {{  band.name | escape  }}']);"></button>
                </div>
            {% else %}
                <div class="navegacao-show-container"></div>
            {% endif %}
            <div class="banda-mais-opcoes banda-mais-opcoes-baixo">
                <h3 class="titulo-no-box titulo-buscas-relacionadas-no-box">Buscas relacionadas</h3>
                <div class="similares-body">
                    {% for similar in band.similares %}
                        {% if loop.index0 %2 == 0 %}<span class="similares-linha {% if loop.index0 == 0 %}primeira-linha-similar{% endif %}">{% endif %}
                        <a href="#minhas-bandas" class="similar info-banda-link" onClick="_gaq.push(['_trackEvent', 'Band', 'Bandas relacionadas no modal', 'Banda principal: {{ band.name }} e banda relacionada: {{ similar.name }}']);">{{ similar.name }}</a>
                        {% if loop.index0 %2 == 1 %}</span>{% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="comentarios invisivel">
            <a class="mostrar-comentarios info-banda-link" href="#comentarios" onclick="loadDisqus(jQuery(this), 'http://bands.com.br/?band={{ band.slug }}', 'http://bands.com.br/?band={{ band.slug }}');">
                Mostrar comentários
            </a>

            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'bands';
                var disqus_identifier = 'http://bands.com.br/?band={{ band.slug }}';
                var disqus_url = 'http://bands.com.br/?band={{ band.slug }}'; //post permalink
                // var disqus_title; //post title

                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function () {
                    var s = document.createElement('script'); s.async = true;
                    s.type = 'text/javascript';
                    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
                    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
                }());
            </script>

        </div>


        {{ band_question.gera_modal(band.slug) }}
        {{ band_tags.gera_modal(band) }}
        {{ bandas_relacionadas.gera_modal(band) }}
        {{ band_products.gera_modal(band, BANDAS_CAMISAS, formulario_pag_seguro) }}
        {{ contribuicao.gera_modal(band) }}

        <button type="button" class="close-banda" onClick="_gaq.push(['_trackEvent', 'Band', 'Fechar o box da banda', 'Banda: {{  band.name | escape  }}']);">&times;</button>
    </li>
{%- endmacro %}
